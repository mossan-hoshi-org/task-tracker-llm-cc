# task-tracker-llm
作業内容を切り替えながら時間を記録できるシンプルなWebアプリ。作業終了後はカテゴリ別に作業時間を整理し、Markdown 形式で出力可能。

## 1. 目的
ユーザが行う作業をタスクとして登録し、ボタン操作のみで開始・停止・一時停止を行って作業時間を計測する。計測結果を Markdown 形式でコピーでき、さらに Google Gemini API によりカテゴリ／小項目へ自動分類しカテゴリ毎の総作業時間を集計する。

## 2. システム構成
### バックエンド
- **開発言語**: Python 3.12 以降
- **Web フレームワーク**: **FastAPI** (最新版)
- **パッケージマネージャー**: **uv**
- **テストフレームワーク**: **pytest**
- **外部サービス**: Google Gemini Generative AI API (REST)

### フロントエンド
- **フレームワーク**: **Next.js 15** (App Router)
- **言語**: **TypeScript**
- **UI ライブラリ**: **shadcn/ui** + **Tailwind CSS**
- **状態管理**: **Zustand**
- **HTTP クライアント**: **TanStack Query**

### データ保存
- ファイル保存は行わず、サマリーを Markdown 文字列としてコピーできれば良い。

### 開発アプローチ
- **TDD (Test-Driven Development)** を採用
- Pythonのテストフレームワークは **pytest** を使用
- 各機能の実装前にテストを書き、テストが通るまで実装を進める
- フロントエンドは **Jest** と **React Testing Library** でテスト

## 3. 操作フロー
1. 作業名を入力し **▶ 計測開始** ボタンを押す → セッション開始。  
2. 別の作業名を入力し再度 **▶** を押す → 直前セッションを自動停止し、次のセッション開始。  
3. **⏸ 一時停止** ボタンで現在セッションを一時停止／再開。  
4. **⏹ 停止** ボタンで全セッションを終了し、サマリー画面へ遷移。  
5. Gemini API に作業一覧を送信し、カテゴリ／小項目分類を取得。  
6. カテゴリ別総作業時間を計算し、Markdown 形式で整形 → クリップボードへコピー可能。  

## 4. 画面仕様
### 4.1 メイン画面 (Web UI)
| UI 要素 | 仕様 |
| --- | --- |
| 作業名入力欄 | レスポンシブデザイン対応のテキストインプット、日本語入力可 |
| **▶ 開始/切替ボタン** | プライマリボタン、新規セッション開始／切替 |
| **⏸ 一時停止ボタン** | セカンダリボタン、セッションを一時停止／再開 |
| **⏹ 停止ボタン** | デンジャーボタン、全セッション終了、サマリーへ |
| 作業一覧リスト | カードコンポーネントで時系列表示、進行中はハイライト表示、経過時間 hh:mm:ss を 1 秒毎更新 |

### 4.2 サマリー画面 (Web UI)
| UI 要素 | 仕様 |
| --- | --- |
| カテゴリ別集計テーブル | レスポンシブデータテーブル、カテゴリ名、所属小項目、合計時間 |
| **Copy Markdown** ボタン | サマリー Markdown をクリップボードへコピー |
| 新規計測ボタン | メイン画面へ戻り、新規計測を開始 |

## 5. 機能要件
| 番号 | ID | 内容 |
| --- | --- | --- |
| 1 | FR-01 | ▶ 押下で新規セッション開始。既存セッションは自動停止・記録 |
| 2 | FR-02 | hh:mm:ss 形式でリアルタイム経過時間を表示（1 秒間隔） |
| 3 | FR-03 | ⏸ ボタンで一時停止／再開をトグル |
| 4 | FR-04 | ⏹ ボタンで全セッションを停止し、サマリー画面へ遷移 |
| 5 | FR-05 | Gemini API へ作業一覧を送信し、カテゴリ／小項目分類を取得 |
| 6 | FR-06 | カテゴリ別合計時間を算出しテーブル表示 |
| 7 | FR-07 | サマリーを Markdown 文字列へ整形し、クリップボードにコピー可能にする |
| 8 | FR-08 | 空入力時には ▶ ボタンを無効化、または警告ダイアログ表示 |
| 9 | FR-09 | API キーは環境変数や設定ファイルで安全に管理 |
|10 | FR-10 | 例外・API エラー時にはユーザへダイアログ表示しアプリがクラッシュしないようにする |

## 6. TDD 開発タスクリスト
以下は TDD (Test-Driven Development) で実装する粒度のタスク。バックエンドから始め、フロントエンドで統合して段階的に完成させる。

### バックエンド API 開発タスク
| # | 開発タスク | テストポイント | 実行状況 |
|---|---|---|:---:|
| 1 | FastAPI プロジェクト初期化 (uv 使用) | サーバーが起動し `/docs` で Swagger が表示される | ✅ |
| 2 | セッションモデルと Pydantic スキーマ定義 | モデルのテストが成功する | 🔳 |
| 3 | セッション管理サービスクラス (start/stop/pause) | ユニットテストで時間計測が正しい | 🔳 |
| 4 | POST `/sessions/start` API エンドポイント | API テストでセッション開始が成功 | 🔳 |
| 5 | PATCH `/sessions/{id}/pause` API エンドポイント | 一時停止・再開の API テスト | 🔳 |
| 6 | POST `/sessions/{id}/stop` API エンドポイント | セッション停止の API テスト | 🔳 |
| 7 | GET `/sessions/active` 現在セッション取得 API | リアルタイムデータ取得の API テスト | 🔳 |
| 8 | POST `/summary/generate` Gemini API 連携 | モック API でカテゴリ分類テスト | 🔳 |
| 9 | GET `/summary/markdown` Markdown 生成 API | Markdown 形式の文字列が正しい | 🔳 |
|10 | CORS 設定とエラーハンドリング | フロントエンドからのAPIアクセスが成功 | 🔳 |

### フロントエンド開発タスク
| # | 開発タスク | 動作確認ポイント | 実行状況 |
|---|---|---|:---:|
| 1 | Next.js プロジェクト初期化 (TypeScript, Tailwind) | ブラウザでページが表示される | 🔳 |
| 2 | Zustand ストアとセッション管理ステート | ステート管理のユニットテスト | 🔳 |
| 3 | TanStack Query で API クライアント設定 | API 呼び出しのテスト | 🔳 |
| 4 | メインページ: タスク入力フォームコンポーネント | フォーム送信で API が呼ばれる | 🔳 |
| 5 | タイマーコントロールボタン (開始/一時停止/停止) | ボタンクリックで API が呼ばれる | 🔳 |
| 6 | アクティブセッション一覧コンポーネント | リアルタイムで時間が更新される | 🔳 |
| 7 | サマリーページ: カテゴリ別テーブルコンポーネント | Gemini 結果がテーブルで表示 | 🔳 |
| 8 | Markdown コピー機能 (Clipboard API) | コピーボタンでクリップボードにコピー | 🔳 |
| 9 | エラーハンドリングとローディング状態 | API エラー時に適切なメッセージ表示 | 🔳 |
|10 | レスポンシブデザインとアクセシビリティ対応 | モバイルでも使いやすい UI | 🔳 |

---

